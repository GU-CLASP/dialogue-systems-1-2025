<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + TS</title>
  </head>
  <body>
    <!-- Background music | It works in loop just after you start the game. -->
    <audio id="bg-music" loop>
      <source src="/audio.mp3" type="audio/mpeg">
      Your browser does not support the audio element.
    </audio>

    <script>
      const audio = document.getElementById('bg-music');

      // Set volume (e.g., 80% of the maximum)
      // audio.volume = 1; // Adjust between 0.0 and 1.0

      // Ensure it plays after the page loads
      document.addEventListener('DOMContentLoaded', () => {
        audio.play().then(() => {
          console.log('Audio is playing');
        }).catch(error => {
          console.error('Error playing audio:', error);
          // Handle autoplay policy restrictions
          if (error.name === 'NotAllowedError') {
            console.log('Autoplay was blocked by the browser. Please interact with the page to play audio.');
            // Add a user interaction event to start playback
            document.addEventListener('click', () => {
              audio.play().then(() => {
                console.log('Audio started after user interaction');
              }).catch(err => {
                console.error('Error playing audio after interaction:', err);
              });
            }, { once: true }); // Only listen for the first click
          }
        });
      });
    </script>

    <div id="app"></div>
    <script type="module" src="/src/main.ts"></script>


    <!-- "Go Back" button -->
    <button id="go-back-btn">Go back.</button>

    <!-- New script for the "Go Back" button -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const goBackBtn = document.getElementById("go-back-btn");

        if (goBackBtn) {
          goBackBtn.addEventListener("click", () => {
            console.log("üîô Go Back button clicked!");

            // Ensure state machine exists
            if (window.machine) {
              console.log("‚ÑπÔ∏è Current State:", window.machine.state.value);
              window.machine.send("CLICK"); // Use "CLICK" if it transitions correctly
            } else {
              console.error("‚ùå State machine not found!");
            }
          });
        } else {
          console.error("‚ùå 'Go Back' button not found!");
        }
      });
    </script>


  </body>
</html>